# HTML编辑器架构设计文档

## 1. 架构概览

HTML编辑器采用清晰的分层架构，遵循SOLID原则，融合多种设计模式，构建可扩展且易维护的系统。

### 1.1 分层结构

```
┌─────────────────┐
│   应用层        │ 命令行界面、用户交互
├─────────────────┤
│   会话层        │ 编辑会话管理、状态控制
├─────────────────┤
│   命令层        │ 编辑与显示命令、撤销重做
├─────────────────┤
│   核心层        │ HTML文档模型、元素结构
├─────────────────┤
│   I/O层         │ 文件读写、HTML解析
├─────────────────┤
│   拼写检查层    │ 文本检查、语法分析
├─────────────────┤
│   工具层        │ 通用工具、验证服务
└─────────────────┘
```

### 1.2 模块依赖关系

```
┌─────────┐      ┌─────────┐      ┌─────────┐      ┌─────────┐
│   I/O   │←─────│   Core  │←─────│ Commands │←─────│ Session │
└─────────┘      └─────────┘      └─────────┘      └─────────┘
     ↑               ↑                ↑                 ↑
     │               │                │                 │
┌─────────┐          │                │                 │
│  Utils  │──────────┴────────────────┘                │
└─────────┘                                            │
     ↑                ┌─────────┐                       │
     └────────────────│SpellCheck│←──────────────────────┘
                      └─────────┘                       │
                                                        │
                                              ┌──────────────┐
                                              │ Application  │
                                              └──────────────┘
```

## 2. 核心模块

### 2.1 核心层 (Core)

**主要组件：**
- **HtmlElement** - HTML元素基类，支持树状结构
- **HtmlModel** - 文档模型，管理元素和ID索引
- **异常类** - 统一的错误处理机制

**设计特点：**
- 使用组合模式表示HTML树结构
- 通过ID索引实现高效元素查找
- 异常机制与返回值相结合反馈操作结果

### 2.2 命令层 (Commands)

**主要组件：**
- **Base** - 命令抽象基类，定义统一接口
- **编辑命令** - 增删改元素的具体指令
- **显示命令** - 视图相关命令
- **IO命令** - 文件操作命令
- **历史记录** - 撤销/重做管理

**设计特点：**
- 命令模式封装所有操作，支持撤销/重做
- 观察者模式实现命令执行通知
- 命令分类管理，职责明确

### 2.3 I/O层

**主要组件：**
- **Parser** - HTML解析器，文本到模型转换
- **Writer** - HTML写入器，模型到文本转换

**设计特点：**
- 适配器模式封装第三方解析库
- 工厂方法创建解析与写入实例

### 2.4 会话层

**主要组件：**
- **SessionManager** - 管理编辑会话
- **Editor** - 单个文件编辑环境
- **State** - 会话状态控制

**设计特点：**
- 单例模式实现会话管理器
- 状态模式处理不同会话状态
- 完整支持多文件编辑

### 2.5 应用层

**主要组件：**
- **CommandParser** - 命令解析器
- **Application** - 程序主类

**设计特点：**
- 工厂模式创建命令实例
- 观察者模式接收命令执行反馈

## 3. 设计模式应用

| 设计模式 | 应用场景 | 核心优势 |
|---------|---------|---------|
| **命令模式** | 所有编辑操作 | 实现撤销/重做，解耦请求与执行 |
| **组合模式** | HTML元素树 | 统一处理单个与组合元素 |
| **访问者模式** | 拼写检查/树遍历 | 在不修改元素类的情况下添加操作 |
| **观察者模式** | 命令执行通知 | 解耦命令执行与状态更新 |
| **适配器模式** | 集成第三方库 | 隔离外部依赖，提高可维护性 |
| **状态模式** | 会话状态管理 | 简化状态转换逻辑 |
| **依赖注入** | 组件间交互 | 提高代码灵活性和可测试性 |

## 4. 扩展性与可维护性

**扩展点：**
- 添加新命令：继承Command基类
- 新显示格式：实现Reporter接口
- 替换拼写检查：实现Checker接口
- UI扩展：命令模式便于添加新界面
- 新会话状态：扩展State类

**权衡考量：**
- 性能优化：ID索引加速查找但增加内存消耗
- 复杂度管理：设计模式增加灵活性但提高理解门槛
- 第三方依赖：限制在特定层并通过适配器隔离

## 5. 测试策略

采用**金字塔测试**策略：

```
    ╱╲
   ╱────╲    系统测试 (10%)
  ╱──────╲   集成测试 (20%)
 ╱────────╲  单元测试 (70%)
╱──────────╲
```

- **单元测试**：每个类的独立功能
- **集成测试**：组件间交互
- **系统测试**：端到端功能验证

测试覆盖核心功能、边界情况和异常处理路径。
